apiVersion: serverless.kyma-project.io/v1alpha2
kind: Function
metadata:
  name: scaled-function
spec:
  runtime: nodejs14
  replicas: 1
  source:
    inline:
      dependencies: ""
      source: |
        module.exports = {
          main: function(event, context) {
            return 'Hello World!'
          }
        }
---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: scaled-function
spec:
  scaleTargetRef:
    apiVersion:    serverless.kyma-project.io/v1alpha2
    kind:          Function
    name:          scaled-function
  minReplicaCount:  1
  maxReplicaCount:  5
  triggers:
  - type: prometheus
    metadata:
      serverAddress: http://prometheus-operated.kyma-system.svc.cluster.local:9090
      metricName: istio_requests_total
      query: sum(rate(istio_requests_total{destination_service_namespace="default", destination_service_name="scaled-function"}[2m])) # returns requests per second
      threshold: '6.5'
      activationThreshold: '0'
