{{- $username := include "tplValue" ( dict "value" .Values.dockerRegistry.username "context" . ) -}}
{{- $password := include "tplValue" ( dict "value" .Values.dockerRegistry.password "context" . ) -}}
{{- $serverAddress := include "tplValue" ( dict "value" .Values.dockerRegistry.serverAddress "context" . ) -}}
{{- $encodedUsernamePassword := printf "%s:%s" $username $password | b64enc }}
apiVersion: v1
kind: Secret
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: "{{- (printf "{\"auths\": {\"%s\": {\"auth\": \"%s\", \"username\":\"%s\",\"password\":\"%s\"}}}" $serverAddress $encodedUsernamePassword $username $password) | b64enc }}"
metadata:
  name: {{ template "fullname" . }}-registry-docker-config
  namespace: {{ .Release.Namespace }}
  labels:
    serverless.kyma-project.io/config: credentials
    serverless.kyma-project.io/credentials: registry-docker-config
---
{{- if .Values.dockerRegistry.enableInternal }}
apiVersion: v1
kind: Secret
type: kubernetes.io/basic-auth
metadata:
  name: {{ template "fullname" . }}-registry-credentials
  namespace: {{ .Release.Namespace }}
  labels:
    serverless.kyma-project.io/config: credentials
    serverless.kyma-project.io/credentials: registry-credentials
stringData:
  username: "{{ $username }}"
  password: "{{ $password }}"
{{- end }}
