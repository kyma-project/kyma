apiVersion: "testing.kyma-project.io/v1alpha1"
kind: TestDefinition
metadata:
  name: apiserver-proxy
spec:
  template:
    metadata:
      annotations:
        sidecar.istio.io/inject: "false"
    spec:
    {{- if .Values.global.isLocalEnv }}
      hostNetwork: true
      dnsPolicy: ClusterFirstWithHostNet
    {{- end }}
      containers:
        - name: test-{{ .Release.Name }}-apiserver-proxy
          image: {{ .Values.global.containerRegistry.path }}/{{ .Values.global.test_apiserver_proxy.dir }}apiserver-proxy-test:{{ .Values.global.test_apiserver_proxy.version }}
          imagePullPolicy: Always
          env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: DOMAIN
            value: {{ .Values.global.ingress.domainName }}
          - name: USER_EMAIL
            valueFrom:
              secretKeyRef:
                name: admin-user
                key: email
          - name: USER_PASSWORD
            valueFrom:
              secretKeyRef:
                name: admin-user
                key: password
