apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app: Kyma
    prometheus: monitoring
    role: alert-rules
  name: namespace-controller-alerts
data:
  alert.rules: |-
    groups:
    - name: namespace-controller-hardware-rules
      rules:
      - alert: namespace-controller-high-memory-usage-alert
        expr: container_memory_usage_bytes{namespace="kyma-system",pod_name=~"^core-namespace-controller-(.*)", container_name!="POD", container_name!=""} / 1024 / 1024 > {{ .Values.alertValues.memory }}
        for: 15s
        labels:
          severity: critical
        annotations:
          description: "High memory usage"
          summary: "Usage of the memory is above {{ .Values.alertValues.memory }}MiB"
      - alert: namespace-controller-high-cpu-usage-alert
        expr: rate(container_cpu_usage_seconds_total{pod_name=~"^core-namespace-controller-(.*)", container_name!="POD", container_name!=""}[1m]) > {{ .Values.alertValues.cpu }}
        for: 15s
        labels:
          severity: critical
        annotations:
          description: "High CPU usage"
          summary: "Usage of the CPU is higher than {{ .Values.alertValues.cpu }}"
