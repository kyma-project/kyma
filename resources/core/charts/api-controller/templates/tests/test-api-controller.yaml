{{ if .Values.tests.enabled }}
---
apiVersion: v1
kind: Pod
metadata:
  name: test-api-controller-acceptance
  annotations:
    "helm.sh/hook": test-success
  labels:
    "helm-chart-test": "true"
spec:
  serviceAccount: api-controller-test-account
  containers:
  - name: test-api-controller-acceptance
    {{ $image_name := "api-controller-acceptance-test" }}
    {{ $image := index .Values.global $image_name }}
    image: {{ .Values.global.containerRegistry.path }}/{{ $image.dir }}{{ $image_name }}:{{ $image.version }}
    resources:
      limits:
        memory: 400Mi
    env:
    - name: DOMAIN_NAME
      value: {{ .Values.global.domainName }}
  restartPolicy: Never
---
{{ end }}