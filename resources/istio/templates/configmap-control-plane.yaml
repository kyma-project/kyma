apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ .Release.Namespace }}
  name: kyma-istio-control-plane-config
  annotations:
    helm.sh/hook: "pre-install,pre-upgrade"
    helm.sh/hook-weight: "5"
data:
  config.yaml: |-
{{ if .Values.global.isLocalEnv }}
{{.Files.Get "files/kyma_minikube_istio_control_plane.yaml" | printf "%s" | indent 4}}
{{ else }}
{{.Files.Get "files/kyma_cluster_istio_control_plane.yaml" | printf "%s" | indent 4}}
{{ end }}
{{ if .Values.kyma_istio_control_plane }}
  #This additional user-provided definition is merged with the default one
  overrides.yaml: |-
{{ .Values.kyma_istio_control_plane | printf "%s" | indent 4 }}
{{ end }}
