{{ define "mem-90-percent-usage-rule.yaml.tpl"}}
groups:
- name: mem-90-percent-usage-rule
  rules:
  - alert: MEM90PercentUsage
    expr:   sum(container_memory_working_set_bytes) by (pod_name) /sum(label_join(kube_pod_container_resource_limits_memory_bytes,
    "pod_name", "", "pod")) by (pod_name)  * on(pod_name) group_left(app)   label_replace(max(kube_pod_labels{label_alertmem=~"yes*"}) by (pod), "pod_name", "$1", "pod", "(.*)") * 100 > 90
    for: 10m
    labels:
      severity: critical
    annotations:
      description:  "Pod {{`{{$labels.pod_name}}`}} is having {{`{{$value}}`}} % usage"
      summary: "Pod {{`{{$labels.pod_name}}`}} is having {{`{{$value}}`}} % usage"
{{ end }}