{{ define "cpu-90-percent-usage-rule.yaml.tpl"}}
groups:
- name: cpu-90-percent-usage-rule
  rules:
  - alert: CPU90PercentUsage
    expr:   max(kube_pod_labels{label_alertcpu=~"yes*"}) by (label_alertcpu,pod) * on(pod) group_right(label_alertcpu) label_replace(sum by(pod_name)(rate(container_cpu_usage_seconds_total{namespace="kyma-system"}[2m]))*100 > 90, "pod", "$1", "pod_name", "(.+)")
    for: 10m
    labels:
      severity: critical
    annotations:
      description:  "Pod {{`{{$labels.pod}}`}} is having {{`{{$value}}`}} % usage"
      summary: "Pod {{`{{$labels.pod}}`}} is having {{`{{$value}}`}} % usage"
{{ end }}