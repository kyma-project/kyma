apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: ory-hydra
  namespace: kyma-system
spec:
  gateways:
    - "kyma-gateway.kyma-system"
  hosts:
    - "oauth2.kyma.local"
  http:
    - match:
        - uri:
            prefix: "/.well-known"
        - uri:
            exact: "/oauth2/auth"
        - uri:
            exact: "/oauth2/revoke"
        - uri:
            exact: "/oauth2/sessions/logout"
        - uri:
            exact: "/oauth2/token"
        - uri:
            exact: "/userinfo"
      route:
        - destination:
            host: ory-hydra-public
            port:
              number: 4444
    - match:
        - uri:
            prefix: "/oauth2/introspect"
        - uri:
            exact: "/clients"
      route:
        - destination:
            host: ory-hydra-admin
            port:
              number: 4445

#apiVersion: networking.istio.io/v1alpha3
#kind: VirtualService
#metadata:
#  name: {{ include "hydra.fullname" . }}-hydra
#  namespace: {{ .Release.Namespace }}
#spec:
#  gateways:
#    - {{ .Values.global.istio.gateway.name }}.{{ .Values.global.istio.gateway.namespace }}
#  hosts:
#    - oauth2.{{ .Values.global.ingress.domainName }}
#  http:
#    - match:
#        - uri:
#            prefix: "/.well-known"
#        - uri:
#            exact: "/oauth2/auth"
#        - uri:
#            exact: "/oauth2/revoke"
#        - uri:
#            exact: "/oauth2/sessions/logout"
#        - uri:
#            exact: "/oauth2/token"
#        - uri:
#            exact: "/userinfo"
#      route:
#        - destination:
#            host: {{ include "hydra.fullname" . }}-hydra-public
#            port:
#              number: {{ .Values.hydra.hydra.config.serve.public.port }}
#    - match:
#        - uri:
#            prefix: "/oauth2/introspect"
#      route:
#        - destination:
#            host: {{ include "hydra.fullname" . }}-hydra-admin
#            port:
#              number: {{ .Values.hydra.hydra.config.serve.admin.port }}