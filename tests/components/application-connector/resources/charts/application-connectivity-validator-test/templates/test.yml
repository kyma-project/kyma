apiVersion: batch/v1
kind: Job
metadata:
  name: application-connectivity-validator-test
  namespace: {{ .Values.namespace }}
spec:
  backoffLimit: 0
  template:
    metadata:
      annotations:
        traffic.sidecar.istio.io/excludeOutboundPorts: "8080"
    spec:
      serviceAccountName: connectivity-validator-test
      initContainers:
        - name: wait-for-services
          image: opsfleet/depends-on
          args:
            - "-service=echoserver"
      containers:
        - name: application-connectivity-validator-test
          image: {{ include "imageurl" (dict "reg" .Values.containerRegistry "img" .Values.images.validatorTest) }}
          imagePullPolicy: Always
      restartPolicy: Never