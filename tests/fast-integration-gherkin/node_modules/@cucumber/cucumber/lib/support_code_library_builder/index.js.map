{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/support_code_library_builder/index.ts"],"names":[],"mappings":"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","sourcesContent":["import _ from 'lodash'\nimport { buildParameterType, getDefinitionLineAndUri } from './build_helpers'\nimport { IdGenerator } from '@cucumber/messages'\nimport * as messages from '@cucumber/messages'\nimport TestCaseHookDefinition from '../models/test_case_hook_definition'\nimport TestStepHookDefinition from '../models/test_step_hook_definition'\nimport TestRunHookDefinition from '../models/test_run_hook_definition'\nimport StepDefinition from '../models/step_definition'\nimport { formatLocation } from '../formatter/helpers'\nimport validateArguments from './validate_arguments'\nimport arity from 'util-arity'\n\nimport {\n  CucumberExpression,\n  ParameterTypeRegistry,\n  RegularExpression,\n} from '@cucumber/cucumber-expressions'\nimport { doesHaveValue, doesNotHaveValue } from '../value_checker'\nimport { validateNoGeneratorFunctions } from './finalize_helpers'\nimport {\n  DefineStepPattern,\n  IDefineStepOptions,\n  IDefineSupportCodeMethods,\n  IDefineTestCaseHookOptions,\n  IDefineTestStepHookOptions,\n  IDefineTestRunHookOptions,\n  IParameterTypeDefinition,\n  ISupportCodeLibrary,\n  TestCaseHookFunction,\n  TestStepHookFunction,\n} from './types'\nimport World from './world'\nimport { ICanonicalSupportCodeIds } from '../runtime/parallel/command_types'\n\ninterface IStepDefinitionConfig {\n  code: any\n  line: number\n  options: any\n  pattern: string | RegExp\n  uri: string\n}\n\ninterface ITestCaseHookDefinitionConfig {\n  code: any\n  line: number\n  options: any\n  uri: string\n}\n\ninterface ITestStepHookDefinitionConfig {\n  code: any\n  line: number\n  options: any\n  uri: string\n}\n\ninterface ITestRunHookDefinitionConfig {\n  code: any\n  line: number\n  options: any\n  uri: string\n}\n\nexport const builtinParameterTypes = ['int', 'float', 'word', 'string', '']\n\nexport class SupportCodeLibraryBuilder {\n  public readonly methods: IDefineSupportCodeMethods\n\n  private afterTestCaseHookDefinitionConfigs: ITestCaseHookDefinitionConfig[]\n  private afterTestRunHookDefinitionConfigs: ITestRunHookDefinitionConfig[]\n  private afterTestStepHookDefinitionConfigs: ITestStepHookDefinitionConfig[]\n  private beforeTestCaseHookDefinitionConfigs: ITestCaseHookDefinitionConfig[]\n  private beforeTestRunHookDefinitionConfigs: ITestRunHookDefinitionConfig[]\n  private beforeTestStepHookDefinitionConfigs: ITestStepHookDefinitionConfig[]\n  private cwd: string\n  private defaultTimeout: number\n  private definitionFunctionWrapper: any\n  private newId: IdGenerator.NewId\n  private parameterTypeRegistry: ParameterTypeRegistry\n  private stepDefinitionConfigs: IStepDefinitionConfig[]\n  private World: any\n\n  constructor() {\n    const defineStep = this.defineStep.bind(this)\n    this.methods = {\n      After: this.defineTestCaseHook(\n        () => this.afterTestCaseHookDefinitionConfigs\n      ),\n      AfterAll: this.defineTestRunHook(\n        () => this.afterTestRunHookDefinitionConfigs\n      ),\n      AfterStep: this.defineTestStepHook(\n        () => this.afterTestStepHookDefinitionConfigs\n      ),\n      Before: this.defineTestCaseHook(\n        () => this.beforeTestCaseHookDefinitionConfigs\n      ),\n      BeforeAll: this.defineTestRunHook(\n        () => this.beforeTestRunHookDefinitionConfigs\n      ),\n      BeforeStep: this.defineTestStepHook(\n        () => this.beforeTestStepHookDefinitionConfigs\n      ),\n      defineParameterType: this.defineParameterType.bind(this),\n      defineStep,\n      Given: defineStep,\n      setDefaultTimeout: (milliseconds) => {\n        this.defaultTimeout = milliseconds\n      },\n      setDefinitionFunctionWrapper: (fn) => {\n        console.log(\n          `setDefinitionFunctionWrapper is deprecated and will be removed in version 8.0.0 of cucumber-js. If this was used to wrap generator functions, please transition to using async / await. If this was used to wrap step definitions, please use BeforeStep / AfterStep hooks instead. If you had other use cases, please create an issue.`\n        )\n        this.definitionFunctionWrapper = fn\n      },\n      setWorldConstructor: (fn) => {\n        this.World = fn\n      },\n      Then: defineStep,\n      When: defineStep,\n    }\n  }\n\n  defineParameterType(options: IParameterTypeDefinition<any>): void {\n    const parameterType = buildParameterType(options)\n    this.parameterTypeRegistry.defineParameterType(parameterType)\n  }\n\n  defineStep(\n    pattern: DefineStepPattern,\n    options: IDefineStepOptions | Function,\n    code?: Function\n  ): void {\n    if (typeof options === 'function') {\n      code = options\n      options = {}\n    }\n    const { line, uri } = getDefinitionLineAndUri(this.cwd)\n    validateArguments({\n      args: { code, pattern, options },\n      fnName: 'defineStep',\n      location: formatLocation({ line, uri }),\n    })\n    this.stepDefinitionConfigs.push({\n      code,\n      line,\n      options,\n      pattern,\n      uri,\n    })\n  }\n\n  defineTestCaseHook(\n    getCollection: () => ITestCaseHookDefinitionConfig[]\n  ): <WorldType>(\n    options:\n      | string\n      | IDefineTestCaseHookOptions\n      | TestCaseHookFunction<WorldType>,\n    code?: TestCaseHookFunction<WorldType>\n  ) => void {\n    return <WorldType>(\n      options:\n        | string\n        | IDefineTestCaseHookOptions\n        | TestCaseHookFunction<WorldType>,\n      code?: TestCaseHookFunction<WorldType>\n    ) => {\n      if (typeof options === 'string') {\n        options = { tags: options }\n      } else if (typeof options === 'function') {\n        code = options\n        options = {}\n      }\n      const { line, uri } = getDefinitionLineAndUri(this.cwd)\n      validateArguments({\n        args: { code, options },\n        fnName: 'defineTestCaseHook',\n        location: formatLocation({ line, uri }),\n      })\n      getCollection().push({\n        code,\n        line,\n        options,\n        uri,\n      })\n    }\n  }\n\n  defineTestStepHook(\n    getCollection: () => ITestStepHookDefinitionConfig[]\n  ): <WorldType>(\n    options:\n      | string\n      | IDefineTestStepHookOptions\n      | TestStepHookFunction<WorldType>,\n    code?: TestStepHookFunction<WorldType>\n  ) => void {\n    return <WorldType>(\n      options:\n        | string\n        | IDefineTestStepHookOptions\n        | TestStepHookFunction<WorldType>,\n      code?: TestStepHookFunction<WorldType>\n    ) => {\n      if (typeof options === 'string') {\n        options = { tags: options }\n      } else if (typeof options === 'function') {\n        code = options\n        options = {}\n      }\n      const { line, uri } = getDefinitionLineAndUri(this.cwd)\n      validateArguments({\n        args: { code, options },\n        fnName: 'defineTestStepHook',\n        location: formatLocation({ line, uri }),\n      })\n      getCollection().push({\n        code,\n        line,\n        options,\n        uri,\n      })\n    }\n  }\n\n  defineTestRunHook(\n    getCollection: () => ITestRunHookDefinitionConfig[]\n  ): (options: IDefineTestRunHookOptions | Function, code?: Function) => void {\n    return (options: IDefineTestRunHookOptions | Function, code?: Function) => {\n      if (typeof options === 'function') {\n        code = options\n        options = {}\n      }\n      const { line, uri } = getDefinitionLineAndUri(this.cwd)\n      validateArguments({\n        args: { code, options },\n        fnName: 'defineTestRunHook',\n        location: formatLocation({ line, uri }),\n      })\n      getCollection().push({\n        code,\n        line,\n        options,\n        uri,\n      })\n    }\n  }\n\n  wrapCode({\n    code,\n    wrapperOptions,\n  }: {\n    code: Function\n    wrapperOptions: any\n  }): Function {\n    if (doesHaveValue(this.definitionFunctionWrapper)) {\n      const codeLength = code.length\n      const wrappedCode = this.definitionFunctionWrapper(code, wrapperOptions)\n      if (wrappedCode !== code) {\n        return arity(codeLength, wrappedCode)\n      }\n      return wrappedCode\n    }\n    return code\n  }\n\n  buildTestCaseHookDefinitions(\n    configs: ITestCaseHookDefinitionConfig[],\n    canonicalIds?: string[]\n  ): TestCaseHookDefinition[] {\n    return configs.map(({ code, line, options, uri }, index) => {\n      const wrappedCode = this.wrapCode({\n        code,\n        wrapperOptions: options.wrapperOptions,\n      })\n      return new TestCaseHookDefinition({\n        code: wrappedCode,\n        id: canonicalIds ? canonicalIds[index] : this.newId(),\n        line,\n        options,\n        unwrappedCode: code,\n        uri,\n      })\n    })\n  }\n\n  buildTestStepHookDefinitions(\n    configs: ITestStepHookDefinitionConfig[]\n  ): TestStepHookDefinition[] {\n    return configs.map(({ code, line, options, uri }) => {\n      const wrappedCode = this.wrapCode({\n        code,\n        wrapperOptions: options.wrapperOptions,\n      })\n      return new TestStepHookDefinition({\n        code: wrappedCode,\n        id: this.newId(),\n        line,\n        options,\n        unwrappedCode: code,\n        uri,\n      })\n    })\n  }\n\n  buildTestRunHookDefinitions(\n    configs: ITestRunHookDefinitionConfig[]\n  ): TestRunHookDefinition[] {\n    return configs.map(({ code, line, options, uri }) => {\n      const wrappedCode = this.wrapCode({\n        code,\n        wrapperOptions: options.wrapperOptions,\n      })\n      return new TestRunHookDefinition({\n        code: wrappedCode,\n        id: this.newId(),\n        line,\n        options,\n        unwrappedCode: code,\n        uri,\n      })\n    })\n  }\n\n  buildStepDefinitions(canonicalIds?: string[]): {\n    stepDefinitions: StepDefinition[]\n    undefinedParameterTypes: messages.UndefinedParameterType[]\n  } {\n    const stepDefinitions: StepDefinition[] = []\n    const undefinedParameterTypes: messages.UndefinedParameterType[] = []\n    this.stepDefinitionConfigs.forEach(\n      ({ code, line, options, pattern, uri }, index) => {\n        let expression\n        if (typeof pattern === 'string') {\n          try {\n            expression = new CucumberExpression(\n              pattern,\n              this.parameterTypeRegistry\n            )\n          } catch (e) {\n            if (doesHaveValue(e.undefinedParameterTypeName)) {\n              undefinedParameterTypes.push({\n                name: e.undefinedParameterTypeName,\n                expression: pattern,\n              })\n              return\n            }\n            throw e\n          }\n        } else {\n          expression = new RegularExpression(\n            pattern,\n            this.parameterTypeRegistry\n          )\n        }\n\n        const wrappedCode = this.wrapCode({\n          code,\n          wrapperOptions: options.wrapperOptions,\n        })\n        stepDefinitions.push(\n          new StepDefinition({\n            code: wrappedCode,\n            expression,\n            id: canonicalIds ? canonicalIds[index] : this.newId(),\n            line,\n            options,\n            pattern,\n            unwrappedCode: code,\n            uri,\n          })\n        )\n      }\n    )\n    return { stepDefinitions, undefinedParameterTypes }\n  }\n\n  finalize(canonicalIds?: ICanonicalSupportCodeIds): ISupportCodeLibrary {\n    if (doesNotHaveValue(this.definitionFunctionWrapper)) {\n      const definitionConfigs = _.chain([\n        this.afterTestCaseHookDefinitionConfigs,\n        this.afterTestRunHookDefinitionConfigs,\n        this.beforeTestCaseHookDefinitionConfigs,\n        this.beforeTestRunHookDefinitionConfigs,\n        this.stepDefinitionConfigs,\n      ])\n        .flatten()\n        .value()\n      validateNoGeneratorFunctions({ cwd: this.cwd, definitionConfigs })\n    }\n    const stepDefinitionsResult = this.buildStepDefinitions(\n      canonicalIds?.stepDefinitionIds\n    )\n    return {\n      afterTestCaseHookDefinitions: this.buildTestCaseHookDefinitions(\n        this.afterTestCaseHookDefinitionConfigs,\n        canonicalIds?.afterTestCaseHookDefinitionIds\n      ),\n      afterTestRunHookDefinitions: this.buildTestRunHookDefinitions(\n        this.afterTestRunHookDefinitionConfigs\n      ),\n      afterTestStepHookDefinitions: this.buildTestStepHookDefinitions(\n        this.afterTestStepHookDefinitionConfigs\n      ),\n      beforeTestCaseHookDefinitions: this.buildTestCaseHookDefinitions(\n        this.beforeTestCaseHookDefinitionConfigs,\n        canonicalIds?.beforeTestCaseHookDefinitionIds\n      ),\n      beforeTestRunHookDefinitions: this.buildTestRunHookDefinitions(\n        this.beforeTestRunHookDefinitionConfigs\n      ),\n      beforeTestStepHookDefinitions: this.buildTestStepHookDefinitions(\n        this.beforeTestStepHookDefinitionConfigs\n      ),\n      defaultTimeout: this.defaultTimeout,\n      parameterTypeRegistry: this.parameterTypeRegistry,\n      undefinedParameterTypes: stepDefinitionsResult.undefinedParameterTypes,\n      stepDefinitions: stepDefinitionsResult.stepDefinitions,\n      World: this.World,\n    }\n  }\n\n  reset(cwd: string, newId: IdGenerator.NewId): void {\n    this.cwd = cwd\n    this.newId = newId\n    this.afterTestCaseHookDefinitionConfigs = []\n    this.afterTestRunHookDefinitionConfigs = []\n    this.afterTestStepHookDefinitionConfigs = []\n    this.beforeTestCaseHookDefinitionConfigs = []\n    this.beforeTestRunHookDefinitionConfigs = []\n    this.beforeTestStepHookDefinitionConfigs = []\n    this.definitionFunctionWrapper = null\n    this.defaultTimeout = 5000\n    this.parameterTypeRegistry = new ParameterTypeRegistry()\n    this.stepDefinitionConfigs = []\n    this.World = World\n  }\n}\n\nexport default new SupportCodeLibraryBuilder()\n"]}