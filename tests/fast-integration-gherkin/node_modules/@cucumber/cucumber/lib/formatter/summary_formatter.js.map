{"version":3,"file":"summary_formatter.js","sourceRoot":"","sources":["../../src/formatter/summary_formatter.ts"],"names":[],"mappings":";;;;;AAAA,oDAAsB;AACtB,uCAA4E;AAC5E,0CAAiD;AACjD,oDAAgD;AAGhD,2DAAuE;AACvE,kCAAmD;AAOnD,MAAqB,gBAAiB,SAAQ,UAAS;IACrD,YAAY,OAA0B;QACpC,KAAK,CAAC,OAAO,CAAC,CAAA;QACd,IAAI,uBAA2C,CAAA;QAC/C,OAAO,CAAC,gBAAgB,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,QAA2B,EAAE,EAAE;YACtE,IAAI,6BAAa,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;gBAC1C,uBAAuB,GAAG,QAAQ,CAAC,cAAc,CAAC,SAAS,CAAA;aAC5D;YACD,IAAI,6BAAa,CAAC,QAAQ,CAAC,eAAe,CAAC,EAAE;gBAC3C,MAAM,wBAAwB,GAAG,QAAQ,CAAC,eAAe,CAAC,SAAS,CAAA;gBACnE,IAAI,CAAC,UAAU,CACb,gCAAyB,CACvB,uBAAuB,EACvB,wBAAwB,CACzB,CACF,CAAA;aACF;QACH,CAAC,CAAC,CAAA;IACJ,CAAC;IAED,UAAU,CAAC,eAAkC;QAC3C,MAAM,QAAQ,GAAuB,EAAE,CAAA;QACvC,MAAM,QAAQ,GAAuB,EAAE,CAAA;QACvC,MAAM,gBAAgB,GAAG,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,EAAE,CAAA;QACtE,gBAAC,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC,eAAe,EAAE,EAAE;YAC3C,IAAI,mBAAS,CAAC,eAAe,CAAC,mBAAmB,CAAC,EAAE;gBAClD,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,CAAA;aAC/B;iBAAM,IAAI,mBAAS,CAAC,eAAe,CAAC,mBAAmB,CAAC,EAAE;gBACzD,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,CAAA;aAC/B;QACH,CAAC,CAAC,CAAA;QACF,IAAI,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,CAAC,MAAM,GAAG,CAAC,EAAE;YAC9D,IAAI,CAAC,GAAG,CACN,6CAA6B,CAC3B,IAAI,CAAC,kBAAkB,CAAC,uBAAuB,CAChD,CACF,CAAA;SACF;QACD,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YACvB,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAA;SACxD;QACD,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YACvB,IAAI,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAA;SACxD;QACD,IAAI,CAAC,GAAG,CACN,uBAAa,CAAC;YACZ,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,gBAAgB;YAChB,eAAe;SAChB,CAAC,CACH,CAAA;IACH,CAAC;IAED,SAAS,CAAC,EAAE,MAAM,EAAE,KAAK,EAAqB;QAC5C,IAAI,CAAC,GAAG,CAAC,GAAG,KAAK,OAAO,CAAC,CAAA;QACzB,MAAM,CAAC,OAAO,CAAC,CAAC,eAAe,EAAE,KAAK,EAAE,EAAE;YACxC,IAAI,CAAC,GAAG,CACN,qBAAW,CAAC;gBACV,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,GAAG,EAAE,IAAI,CAAC,GAAG;gBACb,MAAM,EAAE,KAAK,GAAG,CAAC;gBACjB,cAAc,EAAE,IAAI,CAAC,cAAc;gBACnC,kBAAkB,EAAE,IAAI,CAAC,kBAAkB;gBAC3C,eAAe;aAChB,CAAC,CACH,CAAA;QACH,CAAC,CAAC,CAAA;IACJ,CAAC;CACF;AApED,mCAoEC","sourcesContent":["import _ from 'lodash'\nimport { formatIssue, formatSummary, isFailure, isWarning } from './helpers'\nimport Formatter, { IFormatterOptions } from './'\nimport { doesHaveValue } from '../value_checker'\nimport * as messages from '@cucumber/messages'\nimport { ITestCaseAttempt } from './helpers/event_data_collector'\nimport { formatUndefinedParameterTypes } from './helpers/issue_helpers'\nimport { durationBetweenTimestamps } from '../time'\n\ninterface ILogIssuesRequest {\n  issues: ITestCaseAttempt[]\n  title: string\n}\n\nexport default class SummaryFormatter extends Formatter {\n  constructor(options: IFormatterOptions) {\n    super(options)\n    let testRunStartedTimestamp: messages.Timestamp\n    options.eventBroadcaster.on('envelope', (envelope: messages.Envelope) => {\n      if (doesHaveValue(envelope.testRunStarted)) {\n        testRunStartedTimestamp = envelope.testRunStarted.timestamp\n      }\n      if (doesHaveValue(envelope.testRunFinished)) {\n        const testRunFinishedTimestamp = envelope.testRunFinished.timestamp\n        this.logSummary(\n          durationBetweenTimestamps(\n            testRunStartedTimestamp,\n            testRunFinishedTimestamp\n          )\n        )\n      }\n    })\n  }\n\n  logSummary(testRunDuration: messages.Duration): void {\n    const failures: ITestCaseAttempt[] = []\n    const warnings: ITestCaseAttempt[] = []\n    const testCaseAttempts = this.eventDataCollector.getTestCaseAttempts()\n    _.each(testCaseAttempts, (testCaseAttempt) => {\n      if (isFailure(testCaseAttempt.worstTestStepResult)) {\n        failures.push(testCaseAttempt)\n      } else if (isWarning(testCaseAttempt.worstTestStepResult)) {\n        warnings.push(testCaseAttempt)\n      }\n    })\n    if (this.eventDataCollector.undefinedParameterTypes.length > 0) {\n      this.log(\n        formatUndefinedParameterTypes(\n          this.eventDataCollector.undefinedParameterTypes\n        )\n      )\n    }\n    if (failures.length > 0) {\n      this.logIssues({ issues: failures, title: 'Failures' })\n    }\n    if (warnings.length > 0) {\n      this.logIssues({ issues: warnings, title: 'Warnings' })\n    }\n    this.log(\n      formatSummary({\n        colorFns: this.colorFns,\n        testCaseAttempts,\n        testRunDuration,\n      })\n    )\n  }\n\n  logIssues({ issues, title }: ILogIssuesRequest): void {\n    this.log(`${title}:\\n\\n`)\n    issues.forEach((testCaseAttempt, index) => {\n      this.log(\n        formatIssue({\n          colorFns: this.colorFns,\n          cwd: this.cwd,\n          number: index + 1,\n          snippetBuilder: this.snippetBuilder,\n          supportCodeLibrary: this.supportCodeLibrary,\n          testCaseAttempt,\n        })\n      )\n    })\n  }\n}\n"]}