[FILTER]
    Name                  rewrite_tag
    Match                 .*
    Emitter_Name          logpipeline-1
    Emitter_Storage.type  filesystem
    Emitter_Mem_Buf_Limit 10M
    Rule                  $kubernetes['namespace_name'] "^(?!kyma-system$|kyma-integration$|kube-system$|istio-system$).*" logpipeline-1.$TAG true

[FILTER]
    name                  record_modifier
    match                 logpipeline-1.*
    Record                cluster_identifier ${KUBERNETES_SERVICE_HOST}

[FILTER]
    name                  nest
    match                 logpipeline-1.*
    operation             lift
    nested_under          kubernetes
    add_prefix            __k8s__

[FILTER]
    name                  record_modifier
    match                 logpipeline-1.*
    remove_key            __k8s__annotations

[FILTER]
    name                  nest
    match                 logpipeline-1.*
    operation             nest
    wildcard              __k8s__*
    nest_under            kubernetes
    remove_prefix         __k8s__

[OUTPUT]
    allow_duplicated_headers true
    format json
    host 127.0.0.1
    match logpipeline-1.*
    name http
    port 443
    storage.total_limit_size 1G
    tls on
    tls.verify on

