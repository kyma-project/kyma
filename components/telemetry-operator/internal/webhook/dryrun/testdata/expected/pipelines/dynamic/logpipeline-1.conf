[FILTER]
    Emitter_Mem_Buf_Limit 10M
    Emitter_Name          logpipeline-1
    Emitter_Storage.type  filesystem
    Match                 .*
    Name                  rewrite_tag
    Rule                  $kubernetes['namespace_name'] "^(?!kyma-system$|kyma-integration$|kube-system$|istio-system$).*" logpipeline-1.$TAG true

[FILTER]
    match  logpipeline-1.*
    name   record_modifier
    record cluster_identifier ${KUBERNETES_SERVICE_HOST}

[FILTER]
    add_prefix   __k8s__
    match        logpipeline-1.*
    name         nest
    nested_under kubernetes
    operation    lift

[FILTER]
    match      logpipeline-1.*
    name       record_modifier
    remove_key __k8s__annotations

[FILTER]
    match         logpipeline-1.*
    name          nest
    nest_under    kubernetes
    operation     nest
    remove_prefix __k8s__
    wildcard      __k8s__*

[OUTPUT]
    allow_duplicated_headers true
    format                   json
    host                     127.0.0.1
    match                    logpipeline-1.*
    name                     http
    port                     443
    storage.total_limit_size 1G
    tls                      on
    tls.verify               on

