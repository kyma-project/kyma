[FILTER]
    name                  rewrite_tag
    match                 .*
    emitter_mem_buf_limit 10M
    emitter_name          logpipeline-1
    emitter_storage.type  filesystem
    rule                  $kubernetes['namespace_name'] "^(?!kyma-system$|kyma-integration$|kube-system$|istio-system$).*" logpipeline-1.$TAG true

[FILTER]
    name   record_modifier
    match  logpipeline-1.*
    record cluster_identifier ${KUBERNETES_SERVICE_HOST}

[FILTER]
    name         nest
    match        logpipeline-1.*
    add_prefix   __k8s__
    nested_under kubernetes
    operation    lift

[FILTER]
    name       record_modifier
    match      logpipeline-1.*
    remove_key __k8s__annotations

[FILTER]
    name          nest
    match         logpipeline-1.*
    nest_under    kubernetes
    operation     nest
    remove_prefix __k8s__
    wildcard      __k8s__*

[OUTPUT]
    name                     http
    match                    logpipeline-1.*
    allow_duplicated_headers true
    format                   json
    host                     127.0.0.1
    port                     443
    storage.total_limit_size 1G
    tls                      on
    tls.verify               on

